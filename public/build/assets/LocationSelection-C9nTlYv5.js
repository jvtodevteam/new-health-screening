import{r as n,j as e}from"./app-r-sbB5L-.js";import{M as H,T as Y,a as q,L as B,P as G,u as L}from"./leaflet-CoQeJxKL.js";import{u as J}from"./useTranslation-Dk4TTRaU.js";import{A as K}from"./arrow-left-CmYeyI9Z.js";import{M as u}from"./map-pin-CIvOHqzk.js";import{S as W}from"./search-C21XcFr3.js";import{C as X}from"./chevron-right-D5CQYMkM.js";import"./index-CE8bNrm6.js";import"./createLucideIcon-Dxth2Oq3.js";const Z=new B.Icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ee=({coords:s})=>{const l=L();return n.useEffect(()=>{s&&s[0]&&s[1]&&l.flyTo([s[0]-.008,s[1]],14)},[s,l]),null},te=({city:s,cities:l})=>{const x=L();return n.useEffect(()=>{if(s&&l&&l[s]){const a=l[s];a.latitude&&a.longitude&&(x.setView([a.latitude,a.longitude],13,{animate:!0,duration:1}),setTimeout(()=>{x.invalidateSize(!0),x.setView([a.latitude,a.longitude],13)},100))}},[s,l,x]),null},se=[-7.91303,113.820867],pe=({data:s,setData:l,errors:x,cities:a,onNext:T})=>{const{t:r}=J(),[p,g]=n.useState(""),[i,f]=n.useState(""),[z,b]=n.useState(!1),[c,j]=n.useState(null),[y,h]=n.useState(null),[d,N]=n.useState(1),[w,M]=n.useState([]),[ae,le]=n.useState(!1);n.useEffect(()=>{a&&Object.keys(a).length>0&&f(Object.keys(a)[0])},[a]);const[E,P]=n.useState([]),[ne,D]=n.useState(new Date);n.useEffect(()=>{const t=[];for(let o=0;o<=7;o++){const m=new Date;m.setDate(m.getDate()+o);const U=m.getFullYear(),V=String(m.getMonth()+1).padStart(2,"0"),k=String(m.getDate()).padStart(2,"0"),Q=`${U}-${V}-${k}`;t.push({date:Q,day:m.toLocaleDateString(void 0,{weekday:"short"}),dayNum:k})}P(t),t.length>0&&l("date",t[0].date)},[]);const v=i&&a&&a[i]&&a[i].locations?a[i].locations:[],_=v.filter(t=>t.name.toLowerCase().includes(p.toLowerCase())),S=t=>{j(t),b(!0),g(""),l({...s,location_id:t.id,location_name:t.name,location_description:t.description}),M(t.time_slots||[]),h(null),l("time_slot_id",""),l("time_slot_start",""),l("time_slot_end",""),l("time_slot_label","")},A=t=>{h(t),l({...s,time_slot_id:t.id,time_slot_start:t.start,time_slot_end:t.end,time_slot_label:t.label})},$=t=>{D(new Date(t)),l("date",t)},F=t=>{f(t),j(null),h(null),l({...s,location_id:"",location_name:"",location_description:"",time_slot_id:"",time_slot_start:"",time_slot_end:"",time_slot_label:""}),b(!1)},I=()=>{if(d>1){const t=d-1;N(t);const o=[...s.participants].slice(0,t);l("participants",o)}},O=()=>{if(d<10){const t=d+1;N(t);const o=[...s.participants];for(;o.length<t;)o.push({title:"Mr",name:"",birth_year:"",nationality_id:"",id_number:"",has_medical_history:!1});l("participants",o)}},C=()=>s.location_id&&s.date&&s.time_slot_id,R=()=>{if(i&&a&&a[i]){const t=a[i];if(t.latitude&&t.longitude)return[t.latitude,t.longitude]}return se};return n.useEffect(()=>{window.scrollTo(0,0)},[]),e.jsxs("div",{className:"min-h-screen bg-gray-50 relative",children:[e.jsxs("div",{className:"bg-white p-4 flex items-center shadow-sm",children:[e.jsx("a",{href:route("home"),className:"mr-2",children:e.jsx(K,{size:24,className:"text-gray-800"})}),e.jsx("h1",{className:"text-xl font-bold",children:r.appName})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:r.scheduleAppointment}),e.jsx("p",{className:"text-gray-600 mb-6",children:r.selectDateTimeLocation}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border mb-4 shadow-sm",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-1",children:r.selectDateStep}),e.jsx("p",{className:"text-gray-600 mb-4",children:r.chooseDate}),e.jsx("div",{className:"flex overflow-x-auto pb-2 mb-4 space-x-2",children:E.map((t,o)=>e.jsxs("div",{className:`flex-shrink-0 w-16 h-16 rounded-lg ${t.date===s.date?"bg-green-500 text-white":"bg-gray-100 text-gray-800"} flex flex-col items-center justify-center cursor-pointer`,onClick:()=>$(t.date),children:[e.jsx("span",{className:"text-xs opacity-80",children:t.day}),e.jsx("span",{className:"text-lg font-bold",children:t.dayNum})]},o))})]}),e.jsxs("div",{className:"bg-white p-4 border shadow-sm rounded-xl",children:[e.jsx("div",{className:"flex space-x-2 shadow-sm",children:a&&Object.keys(a).map(t=>e.jsx("button",{className:`flex-1 py-2 px-4 rounded-full text-sm font-medium ${i===t?"bg-green-500 text-white":"bg-gray-100 text-gray-800"}`,onClick:()=>F(t),children:t},t))}),i?e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-48 rounded-xl overflow-hidden shadow-md mb-4",children:e.jsxs(H,{center:R(),zoom:14,style:{height:"100%",width:"100%"},zoomControl:!1,children:[e.jsx(Y,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',className:"grayscale brightness-105 contrast-105"}),e.jsx(te,{city:i,cities:a}),v.map(t=>e.jsx(q,{position:[t.lat,t.lng],icon:Z,eventHandlers:{click:()=>S(t)},children:e.jsx(G,{children:t.name})},t.id)),c&&c.lat&&c.lng&&e.jsx(ee,{coords:[c.lat,c.lng]})]},i)}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:r.searchLocations,className:"w-full bg-white rounded-lg py-3 px-4 pl-10 shadow-sm border border-gray-200",value:p,onChange:t=>g(t.target.value)}),e.jsx(W,{size:18,className:"absolute left-3 top-3.5 text-gray-400"})]}),e.jsx("div",{className:"space-y-3 mb-16",children:_.length>0?_.map(t=>e.jsx("div",{className:`bg-white p-4 rounded-xl shadow-sm border ${c&&c.id===t.id?"border-green-500":"border-gray-100"}`,onClick:()=>S(t),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-500 mr-3",children:e.jsx(u,{size:18})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t.description})]}),e.jsx(X,{size:20,className:"text-gray-400"})]})},t.id)):e.jsx("div",{className:"text-center py-6 bg-white rounded-xl shadow-sm",children:e.jsx("p",{className:"text-gray-500",children:r.noLocationsFound})})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[e.jsx(u,{size:40,className:"text-green-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:r.selectCity}),e.jsx("p",{className:"text-gray-600",children:r.selectCityPrompt})]})]})]}),z&&c&&e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white rounded-t-xl p-6 shadow-lg z-[1000] max-h-[70%] overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-500 mr-3",children:e.jsx(u,{size:16})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"font-medium text-gray-800",children:c.name}),e.jsx("p",{className:"text-xs text-gray-500",children:c.description})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r.participants}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 rounded-lg p-2",children:[e.jsx("button",{onClick:I,className:"w-10 h-10 rounded-full bg-white flex items-center justify-center text-green-500 shadow-sm",disabled:d<=1,children:e.jsx("span",{className:"text-xl font-bold",children:"-"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-xl font-bold text-gray-800",children:d}),e.jsx("p",{className:"text-xs text-gray-500",children:r.peopleLabel})]}),e.jsx("button",{onClick:O,className:"w-10 h-10 rounded-full bg-white flex items-center justify-center text-green-500 shadow-sm",disabled:d>=10,children:e.jsx("span",{className:"text-xl font-bold",children:"+"})})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r.timeSlots||"Time Slots"}),w.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:w.map(t=>e.jsxs("div",{className:`p-3 rounded-lg ${y&&y.id===t.id?"bg-green-500 text-white":"bg-gray-100 text-gray-800"} flex flex-col items-center cursor-pointer`,onClick:()=>A(t),children:[e.jsx("span",{className:"text-xs opacity-80",children:t.label}),e.jsxs("span",{className:"text-sm font-medium",children:[t.start," - ",t.end]})]},t.id))}):e.jsx("div",{className:"text-center py-4 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-500",children:r.noTimeSlotsAvailable||"No time slots available"})})]}),e.jsx("button",{onClick:()=>{window.scrollTo(0,0),T()},className:`w-full py-3 rounded-xl font-medium ${C()?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,disabled:!C(),children:r.next})]})]})};export{pe as default};
